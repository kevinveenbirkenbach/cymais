- name: "include role nginx-modifier-all for {{domain}}"
  include_role: 
    name: nginx-modifier-all

- name: "include role nginx-https-recieve-certificate for {{domain}}"
  include_role: 
    name: nginx-https-recieve-certificate

- name: "Relevant variables for role: {{ role_path | basename }}"
  debug:
    msg:
      domains:              "{{domains}}"
      applications:         "{{applications}}"
  when: enable_debug | bool

- name: "copy nginx domain configuration to {{configuration_destination}}"
  template: 
    src:  "roles/nginx-docker-reverse-proxy/templates/domain.conf.j2" 
    dest: "{{configuration_destination}}"
  notify: restart nginx
  
- name: "include the docker-oauth2-proxy role {{domain}}"
  include_role:
    name: docker-oauth2-proxy
  when: applications[application_id].oauth2_proxy.enabled | default(false) | bool