- block:
    - name: "pkgmgr install"
      include_role:
        name: pkgmgr-install
      vars:
        package_name: "{{ bkp_docker_to_local_pkg }}"

    - name: "Retrieve {{ bkp_docker_to_local_pkg }} path from pkgmgr"
      command: "pkgmgr path {{ bkp_docker_to_local_pkg }}"
      register: pkgmgr_output
      changed_when: false

    - name: Set fact for backup_docker_to_local_folder
      set_fact:
        backup_docker_to_local_folder: "{{ pkgmgr_output.stdout }}/"
      changed_when: false

    - name: "reset (if enabled)"
      include_tasks: reset.yml
      when: mode_reset | bool

    - name: configure sys-bkp-docker-2-loc-everything.infinito.service
      template: 
        src: sys-bkp-docker-2-loc-everything.service.j2
        dest: /etc/systemd/system/sys-bkp-docker-2-loc-everything.infinito.service
      notify: reload sys-bkp-docker-2-loc-everything.infinito.service

    - name: configure sys-bkp-docker-2-loc.infinito.service
      template: 
        src: sys-bkp-docker-2-loc.service.j2
        dest: /etc/systemd/system/sys-bkp-docker-2-loc.infinito.service
      notify: reload sys-bkp-docker-2-loc.infinito.service

    - name: "set 'service_name' to '{{ role_name }}'"
      set_fact:
        service_name: "{{ role_name }}"

    - name: "include role for sys-timer for {{service_name}}"
      include_role:
        name: sys-timer
      vars:
        on_calendar:  "{{on_calendar_backup_docker_to_local}}"

    - name: run the backup_docker_to_local tasks once
      set_fact:
        run_once_sys_bkp_docker_2_loc: true
  
  when: 
    - run_once_sys_bkp_docker_2_loc is not defined
    - database_type is defined and database_type

- name: "include seed-database-to-backup.yml"
  include_tasks: seed-database-to-backup.yml
  when:
    - database_type is defined and database_type
