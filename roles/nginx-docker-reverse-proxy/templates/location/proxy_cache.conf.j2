proxy_cache_path {{ nginx.directories.cache }} levels=1:2 keys_zone=imgcache:10m inactive=60m use_temp_path=off;

{%- if location is defined %}
location ~* ^{{ location }}.*\.(jpg|jpeg|png|gif|webp|ico|svg)$ {
{%- else %}
location ~* \.(jpg|jpeg|png|gif|webp|ico|svg)$ {
{%- endif %}
    # Cache in browser
    expires 30d;
    add_header Cache-Control "public, max-age=2592000, immutable";

    # Cache on reverse proxy side
    proxy_pass http://127.0.0.1:{{http_port}}{{location | default("/")}};
    proxy_cache imgcache;
    proxy_cache_valid 200 302 60m;
    proxy_cache_valid 404 1m;
    add_header X-Proxy-Cache $upstream_cache_status;
}