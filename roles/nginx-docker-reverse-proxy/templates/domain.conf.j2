server
{
  server_name {{domain}};

  # Include OAuth2 Proxy
  {% if oauth2_proxy_active | bool %}
  # OAuth2-Proxy-Endpunkte
  location /oauth2/ {
      proxy_pass http://127.0.0.1:{{oauth2_proxy_port}};
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
  }
  {% endif %}

  # Include Matomo Tracking Code
  {% if nginx_matomo_tracking | bool %}
    {% include 'roles/nginx-matomo-tracking/templates/matomo-tracking.conf.j2' %}
  {% endif %}

  # Additional Domain Specific Configuration
  {% if nginx_docker_reverse_proxy_extra_configuration is defined %}
    {{nginx_docker_reverse_proxy_extra_configuration}}
  {% endif %}

  {% include 'roles/letsencrypt/templates/ssl_header.j2' %}

  {% include 'proxy_pass.conf.j2' %}

}
